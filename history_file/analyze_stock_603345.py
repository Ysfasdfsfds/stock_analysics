import pandas as pd
import numpy as np
from datetime import datetime, timedelta
import requests
import json

def get_stock_data_603696(date_str):
    """
    è·å–603696è‚¡ç¥¨åœ¨æŒ‡å®šæ—¥æœŸçš„äº¤æ˜“æ•°æ®
    ç”±äºè¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æ¥å±•ç¤ºåˆ†ææ–¹æ³•
    """
    
    # è‚¡ç¥¨ä»£ç 603696 - æµ·å—çŸ¿ä¸š
    stock_code = "603696"
    
    # æ¨¡æ‹Ÿ603696åœ¨2024å¹´8æœˆ22æ—¥çš„äº¤æ˜“æ•°æ®
    # å®é™…åº”ç”¨ä¸­åº”è¯¥ä½¿ç”¨çœŸå®çš„è‚¡ç¥¨æ•°æ®API
    mock_data = {
        'è‚¡ç¥¨ä»£ç ': '603696',
        'è‚¡ç¥¨åç§°': 'å®‰äº•é£Ÿå“',
        'äº¤æ˜“æ—¥æœŸ': date_str,
        'å¼€ç›˜ä»·': 78.50,
        'æ”¶ç›˜ä»·': 79.25,
        'æœ€é«˜ä»·': 80.12,
        'æœ€ä½ä»·': 77.80,
        'æˆäº¤é‡': 2456800,  # æ‰‹
        'æˆäº¤é¢': 194500000,  # å…ƒ
        'æ¶¨è·Œå¹…': 1.28,  # %
        'æ¶¨è·Œé¢': 1.00,
        'æ¢æ‰‹ç‡': 2.45,  # %
        'å¸‚ç›ˆç‡': 25.8,
        'å¸‚å‡€ç‡': 3.2,
        'æ€»å¸‚å€¼': 232500000000,  # å…ƒ
        'æµé€šå¸‚å€¼': 232500000000  # å…ƒ
    }
    
    return mock_data

def analyze_trading_data(data):
    """
    åˆ†æäº¤æ˜“æ•°æ®
    """
    print("=" * 60)
    print(f"è‚¡ç¥¨ä»£ç : {data['è‚¡ç¥¨ä»£ç ']} - {data['è‚¡ç¥¨åç§°']}")
    print(f"åˆ†ææ—¥æœŸ: {data['äº¤æ˜“æ—¥æœŸ']}")
    print("=" * 60)
    
    # ä»·æ ¼åˆ†æ
    print("\nğŸ“Š ä»·æ ¼åˆ†æ:")
    print(f"å¼€ç›˜ä»·: Â¥{data['å¼€ç›˜ä»·']:.2f}")
    print(f"æ”¶ç›˜ä»·: Â¥{data['æ”¶ç›˜ä»·']:.2f}")
    print(f"æœ€é«˜ä»·: Â¥{data['æœ€é«˜ä»·']:.2f}")
    print(f"æœ€ä½ä»·: Â¥{data['æœ€ä½ä»·']:.2f}")
    
    price_range = data['æœ€é«˜ä»·'] - data['æœ€ä½ä»·']
    print(f"æ—¥å†…æ³¢å¹…: Â¥{price_range:.2f} ({(price_range/data['å¼€ç›˜ä»·']*100):.2f}%)")
    
    # æ¶¨è·Œåˆ†æ
    print(f"\nğŸ“ˆ æ¶¨è·Œåˆ†æ:")
    print(f"æ¶¨è·Œé¢: Â¥{data['æ¶¨è·Œé¢']:.2f}")
    print(f"æ¶¨è·Œå¹…: {data['æ¶¨è·Œå¹…']:.2f}%")
    
    if data['æ¶¨è·Œå¹…'] > 0:
        print("âœ… å½“æ—¥ä¸Šæ¶¨")
    elif data['æ¶¨è·Œå¹…'] < 0:
        print("âŒ å½“å¤©ä¸‹è·Œ")
    else:
        print("â¡ï¸ å½“æ—¥å¹³ç›˜")
    
    # æˆäº¤é‡åˆ†æ
    print(f"\nğŸ“Š æˆäº¤åˆ†æ:")
    print(f"æˆäº¤é‡: {data['æˆäº¤é‡']:,} æ‰‹")
    print(f"æˆäº¤é¢: Â¥{data['æˆäº¤é¢']:,.0f}")
    print(f"æ¢æ‰‹ç‡: {data['æ¢æ‰‹ç‡']:.2f}%")
    
    # ä¼°å€¼åˆ†æ
    print(f"\nğŸ’° ä¼°å€¼åˆ†æ:")
    print(f"å¸‚ç›ˆç‡(TTM): {data['å¸‚ç›ˆç‡']:.1f}")
    print(f"å¸‚å‡€ç‡: {data['å¸‚å‡€ç‡']:.1f}")
    print(f"æ€»å¸‚å€¼: Â¥{data['æ€»å¸‚å€¼']/1e8:.1f} äº¿")
    print(f"æµé€šå¸‚å€¼: Â¥{data['æµé€šå¸‚å€¼']/1e8:.1f} äº¿")
    
    return data

def get_real_time_data(stock_code, date_str):
    """
    è·å–å®æ—¶è‚¡ç¥¨æ•°æ®çš„å‡½æ•°æ¡†æ¶
    å®é™…ä½¿ç”¨æ—¶éœ€è¦æ¥å…¥çœŸå®çš„è‚¡ç¥¨æ•°æ®API
    """
    
    # è¿™é‡Œå¯ä»¥æ¥å…¥çœŸå®çš„è‚¡ç¥¨æ•°æ®API
    # ä¾‹å¦‚ï¼štushare, akshare, æˆ–è€…åˆ¸å•†API
    
    print("âš ï¸  æ³¨æ„: å½“å‰ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿæ•°æ®")
    print("å¦‚éœ€çœŸå®æ•°æ®ï¼Œå»ºè®®æ¥å…¥ä»¥ä¸‹æ•°æ®æº:")
    print("1. tushare pro (éœ€è¦æ³¨å†Œè·å–token)")
    print("2. akshare (å¼€æºå…è´¹)")
    print("3. åˆ¸å•†API (å¦‚åæ³°ã€ä¸­ä¿¡ç­‰)")
    print("4. æ–°æµªè´¢ç»ã€ä¸œæ–¹è´¢å¯Œç­‰ç½‘ç«™")
    
    return get_stock_data_603696(date_str)

def generate_analysis_report(date_str):
    """
    ç”Ÿæˆå®Œæ•´çš„åˆ†ææŠ¥å‘Š
    """
    
    print("ğŸš€ å¼€å§‹åˆ†æ603696è‚¡ç¥¨æ•°æ®...")
    
    # è·å–æ•°æ®
    data = get_real_time_data("603696", date_str)
    
    # åˆ†ææ•°æ®
    analyzed_data = analyze_trading_data(data)
    
    # ç”Ÿæˆå»ºè®®
    print("\n" + "=" * 60)
    print("ğŸ¯ æŠ•èµ„å»ºè®®:")
    print("=" * 60)
    
    # åŸºäºæ•°æ®çš„ç®€å•åˆ†æå»ºè®®
    if analyzed_data['æ¶¨è·Œå¹…'] > 2:
        print("ğŸ“ˆ å¼ºåŠ¿ä¸Šæ¶¨ï¼Œå…³æ³¨åç»­é‡èƒ½å˜åŒ–")
    elif analyzed_data['æ¶¨è·Œå¹…'] > 0:
        print("ğŸ“Š æ¸©å’Œä¸Šæ¶¨ï¼Œèµ°åŠ¿ç¨³å¥")
    elif analyzed_data['æ¶¨è·Œå¹…'] > -2:
        print("ğŸ“‰ æ¸©å’Œè°ƒæ•´ï¼Œå…³æ³¨æ”¯æ’‘ä½")
    else:
        print("âš ï¸  å¤§å¹…ä¸‹è·Œï¼Œè°¨æ…è§‚æœ›")
    
    if analyzed_data['æ¢æ‰‹ç‡'] > 5:
        print("ğŸ”¥ é«˜æ¢æ‰‹ç‡ï¼Œèµ„é‡‘æ´»è·ƒ")
    elif analyzed_data['æ¢æ‰‹ç‡'] > 3:
        print("ğŸ“Š ä¸­ç­‰æ¢æ‰‹ç‡ï¼Œæ­£å¸¸äº¤æ˜“")
    else:
        print("ğŸ’¤ ä½æ¢æ‰‹ç‡ï¼Œäº¤æ˜“æ¸…æ·¡")
    
    # ä¿å­˜åˆ†æç»“æœ
    df = pd.DataFrame([analyzed_data])
    output_file = f"/Users/huangchuang/Downloads/é‡‘èæ•°æ®åˆ†æ/603696_åˆ†æ_{date_str.replace('-', '')}.csv"
    df.to_csv(output_file, index=False, encoding='utf-8-sig')
    print(f"\nğŸ“„ åˆ†æç»“æœå·²ä¿å­˜è‡³: {output_file}")
    
    return analyzed_data

if __name__ == "__main__":
    # åˆ†æ2024å¹´8æœˆ22æ—¥çš„æ•°æ®
    target_date = "2024-08-22"
    result = generate_analysis_report(target_date)