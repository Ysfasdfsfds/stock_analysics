const a="http://localhost:5001/api";async function u(r){try{const t=await fetch(`${a}/sh-a/stock/${r}/stock_value_em`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();if(e.code!==200)throw new Error(e.message||"获取股票估值数据失败");return e.data}catch(t){throw console.error(`获取股票 ${r} 估值数据失败:`,t),t}}async function s(r){try{const t=await fetch(`${a}/sh-a/stock/${r}/type`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();if(e.code!==200)throw new Error(e.message||"获取股票行业信息失败");return e.data}catch(t){throw console.error(`获取股票 ${r} 行业信息失败:`,t),t}}async function l(r){try{const t=await fetch(`${a}/sh-a/stock/${r}/stock_individual_fund_flow`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();if(e.code!==200)throw new Error(e.message||"获取股票资金流向数据失败");return e.data}catch(t){throw console.error(`获取股票 ${r} 资金流向数据失败:`,t),t}}async function f(){try{const r=await fetch(`${a}/sh-a/realtime`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const t=await r.json();if(t.code===200)return t.data.stocks;throw new Error(t.message||"获取数据失败")}catch(r){throw console.error("获取股票数据失败:",r),r}}async function p(r){return await Promise.all(r.map(async e=>{if(e.industry&&e.industry!=="加载中...")return e;try{const n=await s(e.code);return{...e,industry:n.industry}}catch(n){return console.warn(`获取股票 ${e.code} 行业信息失败:`,n),{...e,industry:"未知"}}}))}async function h(){try{return(await f()).map(e=>({...e,industry:"加载中..."}))}catch(r){throw console.error("获取股票数据失败:",r),r}}function w(r,t){let e=[...r];return t.code&&(e=e.filter(n=>n.code.includes(t.code))),t.name&&(e=e.filter(n=>n.name.includes(t.name))),t.minPrice&&(e=e.filter(n=>n.latest_price>=parseFloat(t.minPrice))),t.maxPrice&&(e=e.filter(n=>n.latest_price<=parseFloat(t.maxPrice))),t.minPE&&(e=e.filter(n=>n.pe_ratio>=parseFloat(t.minPE))),t.maxPE&&(e=e.filter(n=>n.pe_ratio<=parseFloat(t.maxPE))),t.minMarketCap&&(e=e.filter(n=>n.circulation_market_cap>=parseFloat(t.minMarketCap))),t.maxMarketCap&&(e=e.filter(n=>n.circulation_market_cap<=parseFloat(t.maxMarketCap))),t.minChange&&(e=e.filter(n=>n.change_percent>=parseFloat(t.minChange))),t.maxChange&&(e=e.filter(n=>n.change_percent<=parseFloat(t.maxChange))),e}function d(r,t,e){return t?[...r].sort((n,c)=>{const i=n[t],o=c[t];return typeof i=="string"&&typeof o=="string"?e==="asc"?i.localeCompare(o):o.localeCompare(i):typeof i=="number"&&typeof o=="number"?e==="asc"?i-o:o-i:0}):r}function y(r){const t=r.length,e=r.filter(o=>o.change_percent>0).length,n=r.filter(o=>o.change_percent<0).length,c=r.filter(o=>o.change_percent===0).length,i=t>0?e/t*100:0;return{total:t,upCount:e,downCount:n,flatCount:c,upRatio:i}}function k(r){return isNaN(r)||r===0?"--":r>=1e8?`${(r/1e8).toFixed(2)}亿`:r>=1e4?`${(r/1e4).toFixed(2)}万`:r.toString()}export{h as a,f as b,y as c,u as d,p as e,w as f,s as g,l as h,k as i,d as s};
