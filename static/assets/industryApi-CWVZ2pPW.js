const f="http://localhost:5001/api";async function g(){try{const a=await(await fetch(`${f}/sh-a/industries`)).json();if(a.code!==200||!a.data||!a.data.industries)throw new Error(a.message||"获取行业数据失败");const n=a.data.industries,s=await(await fetch(`${f}/sh-a/realtime`)).json();if(s.code===200&&s.data&&s.data.stocks){const r=new Map;s.data.stocks.forEach(e=>{r.set(e.code,e)}),n.forEach(e=>{const c=y(e,r);Object.assign(e,c)})}return n}catch(o){throw console.error("获取行业数据错误:",o),o}}function y(o,a){let n=0,i=0,s=0,r=0,e=0,c=0,d=0,l=0,h=0,u=0;return o.stocks.forEach(p=>{const t=a.get(p.code);t&&(typeof t.change_percent=="number"&&(n+=t.change_percent,c++),typeof t.pe_ratio=="number"&&t.pe_ratio>0&&(i+=t.pe_ratio,d++),typeof t.pb_ratio=="number"&&t.pb_ratio>0&&(s+=t.pb_ratio,l++),typeof t.change_60day=="number"&&(r+=t.change_60day,h++),typeof t.change_ytd=="number"&&(e+=t.change_ytd,u++))}),{avgChangePercent:c>0?n/c:0,avgPeRatio:d>0?i/d:0,avgPbRatio:l>0?s/l:0,avgChange60Day:h>0?r/h:0,avgChangeYtd:u>0?e/u:0}}async function _(o){try{return(await g()).find(n=>n.industry===o)||null}catch(a){throw console.error("获取行业详情错误:",a),a}}export{_ as a,g as f};
